<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.luosee.manager.audit.qualification.QualificationDao">
   <!--
    private Integer certificationId;//认证ID
    private Integer businessInfoId;//商家id
    private String companyName;//公司名字
    private String contactName;//联系人姓名
    private String contactMobile;//固话
    private String contactPhone;//手机
    private String website;//公司网址
    private String contactEmail;//公司邮箱
    private String companyAddress;//公司地址
    private String companyType;//营业类型
    private String licenseNumber;//营业号码
    private String licenseImg;//营业执照图
    private String certificationStatus;//认证状态
    private String certificationCause;//认证原因
    private Timestamp certificationTime;//认证时间
    -->
    <resultMap type="com.luosee.manager.audit.qualification.Qualification" id="qualificationResultMap">
        <id property="certificationId" column="certificationId" />
        <result property="businessInfoId" column="businessInfoId" />
        <result property="companyName" column="companyName" />
        <result property="contactName" column="contactName" />
        <result property="contactMobile" column=" contactMobile" />
        <result property="contactPhone" column="contactPhone" />
        <result property="website" column="website" />
        <result property="contactEmail" column="contactEmail" />
        <result property="companyAddress" column="companyAddress" />
        <result property="companyType" column="companyType" />
        <result property="licenseNumber" column="licenseNumber" />
        <result property="licenseImg" column="licenseImg" />
        <result property="certificationStatus" column="certificationStatus" />
        <result property="certificationCause" column="certificationCause" />
        <result property="certificationTime" column="certificationTime" />
    </resultMap>


    <select id="selectAllunaudited"  resultMap="qualificationResultMap" parameterType="java.util.Map">
        SELECT * FROM
        (SELECT * from tb_business_certification ORDER BY certificationTime DESC) a
        <where>
            (certificationStatus = '认证中' or certificationStatus = '认证失败')
            <if test="title != null">
                and companyName like '%${title}%'
            </if>
        </where>
        GROUP BY businessInfoId
        <if test="flag1 == '6'.toString()">
            ORDER BY certificationId DESC
        </if>
        <if test="flag1 == '7'.toString()">
            ORDER BY certificationId ASC
        </if>
        <if test="flag1 == '2'.toString()">
            ORDER BY companyName ASC
        </if>
        <if test="flag1 == '3'.toString()">
            ORDER BY companyName DESC
        </if>
        <if test="flag1 == '4'.toString()">
            ORDER BY contactName ASC
        </if>
        <if test="flag1 == '5'.toString()">
            ORDER BY contactName DESC
        </if>
        <if test="flag1 == '1'.toString()">
            ORDER BY certificationTime ASC
        </if>
        <if test="flag1 == '0'.toString()">
            ORDER BY certificationTime DESC
        </if>
        <if test="flag1 == '8'.toString()">
            ORDER BY certificationStatus ASC
        </if>
        <if test="flag1 == '9'.toString()">
            ORDER BY certificationStatus DESC
        </if>
        limit #{page.dbIndex},#{page.dbNumber}
    </select>

    <select id="selectAllaudited"  resultMap="qualificationResultMap" parameterType="java.util.Map">
        SELECT * FROM
        (SELECT * from tb_business_certification ORDER BY certificationTime DESC ) a
        <where>
            certificationStatus = '认证成功'
            <if test="title != null">
                and companyName like '%${title}%'
            </if>
        </where>
        GROUP BY businessInfoId
        <if test="flag1 == '6'.toString()">
            ORDER BY certificationId DESC
        </if>
        <if test="flag1 == '7'.toString()">
            ORDER BY certificationId ASC
        </if>
        <if test="flag1 == '2'.toString()">
            ORDER BY companyName ASC
        </if>
        <if test="flag1 == '3'.toString()">
            ORDER BY companyName DESC
        </if>
        <if test="flag1 == '4'.toString()">
            ORDER BY contactName ASC
        </if>
        <if test="flag1 == '5'.toString()">
            ORDER BY contactName DESC
        </if>
        <if test="flag1 == '1'.toString()">
            ORDER BY certificationTime ASC
        </if>
        <if test="flag1 == '0'.toString()">
            ORDER BY certificationTime DESC
        </if>
        limit #{page.dbIndex},#{page.dbNumber}
    </select>

    <select id="countun"  parameterType="java.util.Map" resultType="int">
        SELECT count(*) from (SELECT * from tb_business_certification GROUP BY businessInfoId ORDER BY certificationTime DESC) a
        <where>
            certificationStatus = '认证中' or certificationStatus = '认证失败'
            <if test="title != null">
                and companyName like '%${title}%'
            </if>
        </where>

    </select>

    <select id="count"  parameterType="java.util.Map" resultType="int">
        SELECT count(*) from (SELECT * from tb_business_certification GROUP BY businessInfoId ORDER BY certificationTime DESC) a
        <where>
            certificationStatus = '认证成功'
            <if test="title != null">
                and companyName like '%${title}%'
            </if>
        </where>
    </select>

    <update id="veto" parameterType="com.luosee.manager.audit.qualification.Qualification">
        UPDATE tb_business_certification set certificationCause=#{certificationCause},certificationStatus=#{certificationStatus} WHERE companyName=#{companyName}
    </update>

    <update id="pass" parameterType="com.luosee.manager.audit.qualification.Qualification">
        UPDATE tb_business_certification set certificationStatus=#{certificationStatus} WHERE certificationId=#{certificationId}
    </update>

    <update id="cancel" parameterType="com.luosee.manager.audit.qualification.Qualification">
        UPDATE tb_business_certification set certificationStatus=#{certificationStatus} WHERE certificationId=#{certificationId}
    </update>

    <update id="change" parameterType="com.luosee.manager.audit.qualification.Qualification">
        UPDATE tb_business_certification set certificationStatus=#{certificationStatus} WHERE certificationId=#{certificationId}
    </update>

</mapper>

