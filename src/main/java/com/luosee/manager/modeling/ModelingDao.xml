<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.luosee.manager.modeling.ModelingDao">
   <!--
    private Integer modelId;//模型ID
    private Integer status;//制作状态（0：等待资料审核, 1：确认制作费, 2：确认制作, 3：等待制作, 4：制作中, 5：等待审核中, 6：审核打回, 7：制作完成, 8：制作失败）
    private Integer makerId;//制作员ID
    private Integer reviewerId;//审核员ID
    private Timestamp createTime;//创建时间
    private Timestamp startMakeTime;//开始制作时间
    private Timestamp finishMaketime;//完成制作时间
    private Timestamp lastReviewTime;//最后修改时间
    private Timestamp predictMakeDay;//预估工作时间
    private Integer businessUserId;//商户名称
    private String modelName;//模型名称
    private String genAssetName;//生成的assetname
    private Integer styleId;//风格ID
    private String styleName;//风格名字
    private Integer typeId;//分类ID
    private String typeName;//分类名字
    private String modelImages;//模型图片
    private String description;//描述
    private String vetoReason;//打回原因
    private Integer attachType;
    private Integer scaleType;
    private Integer rotateType;
    private String tagNames;
    -->
    <resultMap type="com.luosee.manager.modeling.Modeling" id="ModelingResultMap">
        <id property="modelId" column="modelId" />
        <result property="status" column="status" />
        <result property="makerId" column="makerId" />
        <result property="reviewerId" column="reviewerId" />
        <result property="createTime" column="createTime" />
        <result property="finishMaketime" column="finishMaketime" />
        <result property="lastReviewTime" column="lastReviewTime" />
        <result property="businessUserId" column="businessUserId" />
        <result property="modelName" column="modelName" />
        <result property="genAssetName" column="genAssetName" />
        <result property="styleId" column="styleId" />
        <result property="styleName" column="styleName" />
        <result property="typeId" column="typeId" />
        <result property="typeName" column="typeName" />
        <result property="modelImages" column="modelImages" />
        <result property="description" column="description" />
        <result property="vetoReason" column="vetoReason" />
        <result property="introduceImg" column="introduceImg" />
        <result property="filepath" column="filepath" />
        <result property="productStatus" column="productstatus" />
        <result property="attachType" column="attachType" />
        <result property="scaleType" column="scaleType" />
        <result property="rotateType" column="rotateType" />
        <result property="tagNames" column="tagNames" />
        <result property="certificationStatus" column="certificationStatus" />
    </resultMap>


    <select id="selectAllByStatus"  resultMap="ModelingResultMap" parameterType="java.util.Map">
        SELECT a.modelId,a.modelName,b.styleName,d.typeName,a.modelImages,a.description,a.createTime,a.finishMaketime,a.lastReviewTime,a.predictMakeDay,a.status,f.productstatus,a.introduceImg,
               f.attachType,f.scaleType,f.rotateType,f.tagNames
        from tb_business_model a left JOIN tb_style b ON a.styleId = b.styleId LEFT JOIN tb_type d ON a.typeId = d.typeId LEFT JOIN tb_product_copy f ON a.modelId = f.modelId
        <where>
            <if test="modeling.status != null">
                and a.status = #{modeling.status}
            </if>
            <if test="title != null">
                and a.modelId like '%${title}%' or a.modelName like '%${title}%'
            </if>
        </where>
        <if test="flag1 == '0'.toString()">
            ORDER BY a.modelId ASC
        </if>
        <if test="flag1 == '1'.toString()">
            ORDER BY a.modelId DESC
        </if>
        <if test="flag1 == '2'.toString()">
            ORDER BY a.modelName ASC
        </if>
        <if test="flag1 == '3'.toString()">
            ORDER BY a.modelName DESC
        </if>
        <if test="flag1 == '4'.toString()">
            ORDER BY a.createTime ASC
        </if>
        <if test="flag1 == '5'.toString()">
            ORDER BY a.createTime DESC
        </if>
        <if test="flag1 == '6'.toString()">
            ORDER BY a.finishMaketime ASC
        </if>
        <if test="flag1 == '7'.toString()">
            ORDER BY a.finishMaketime DESC
        </if>
        <if test="flag1 == '8'.toString()">
            ORDER BY a.lastReviewTime ASC
        </if>
        <if test="flag1 == '9'.toString()">
            ORDER BY a.lastReviewTime DESC
        </if>
        limit #{page.dbIndex},#{page.dbNumber}
    </select>

    <select id="count" parameterType="java.util.Map" resultType="int">
        SELECT COUNT(*) FROM tb_business_model
        <where>
            <if test="modeling.status != null">
                and status = #{modeling.status}
            </if>
            <if test="title != null">
                and modelId like '%${title}%' or modelName like '%${title}%'
            </if>
        </where>
    </select>

    <update id="veto" parameterType="com.luosee.manager.modeling.Modeling">
        UPDATE tb_business_model set vetoReason=#{vetoReason},status=#{status} WHERE modelId=#{modelId}
    </update>

    <update id="changestatus" parameterType="com.luosee.manager.modeling.Modeling">
        UPDATE tb_business_model set status=#{status} WHERE modelId=#{modelId}
    </update>
    
    <update id="tomodal" parameterType="com.luosee.manager.modeling.Modeling">
       UPDATE tb_business_model
       <set>
           <if test="modelName != null and modelName != ''">
               modelName=#{modelName},
           </if>
           <if test="status != null and status != ''">
               status=#{status},
           </if>
           <if test="filepath != null and filepath != ''">
               filepath=#{filepath},
           </if>
           <if test="introduceImg != null and introduceImg != ''">
               introduceImg=#{introduceImg},
           </if>
           <if test="description != null and description != ''">
               description=#{description},
           </if>
           <if test="typeId != null and typeId != ''">
               typeId=#{typeId},
           </if>
           <if test="styleId != null and styleId != ''">
               styleId=#{styleId}
           </if>
       </set>
       WHERE modelId=#{modelId}
    </update>

    <insert id="topruduct" parameterType="com.luosee.manager.modeling.Modeling">
        INSERT INTO tb_product_copy(productName,description,typeId,styleId,attachType,scaleType,rotateType,tagNames,introduceImg,modelId,certificationStatus)
        VALUES (#{modelName},#{description},#{typeId},#{styleId},#{attachType},#{scaleType},#{rotateType},#{tagNames},#{introduceImg},#{modelId},#{certificationStatus})
    </insert>

    <update id="updatepruduct" parameterType="com.luosee.manager.modeling.Modeling">
        UPDATE tb_product_copy
        <set>
            <if test="modelName != null and modelName != ''">
                productName=#{modelName},
            </if>
            <if test="description != null and description != ''">
                description=#{description},
            </if>
            <if test="typeId != null and typeId != ''">
                typeId=#{typeId},
            </if>
            <if test="styleId != null and styleId != ''">
                styleId=#{styleId},
            </if>
            <if test="attachType != null and attachType != ''">
                attachType=#{attachType},
            </if>
            <if test="scaleType != null and scaleType != ''">
                scaleType=#{scaleType},
            </if>
            <if test="rotateType != null and rotateType != ''">
                rotateType=#{rotateType},
            </if>
            <if test="tagNames != null and tagNames != ''">
                tagNames=#{tagNames},
            </if>
            <if test="introduceImg != null and introduceImg != ''">
                introduceImg=#{introduceImg}
            </if>
        </set>
        WHERE modelId=#{modelId}
    </update>

    <update id="changeProductStatus" parameterType="com.luosee.manager.modeling.Modeling" >
        UPDATE tb_product_copy set productstatus=#{productStatus} WHERE modelId=#{modelId}
    </update>

</mapper>

